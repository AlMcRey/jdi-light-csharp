-
  branches:
    only:
    - nuget

  image: Visual Studio 2017

  before_build:
  - nuget restore JDI.Light/JDI.Light.sln
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/set-screenresolution.ps1'))
  - ps: Set-ScreenResolution 1280 1024

  build_script:
    - msbuild JDI.Light/JDI.Light.sln /p:Configuration=Release /t:Rebuild

  test_script:
  - ps: .\TestsAndCoverage.ps1

  after_build:
    - nuget pack "JDI.Light/JDI.Light/JDI.Light.csproj" -Prop Configuration=Release

  artifacts:
    - path: '*.nupkg'
      name: nupkg

  deploy:
    provider: NuGet
    server:
    api_key:
      secure: crLYbWXNgfrzYazkV18cEBRKnl90ee0wjWUfZGIDhkZcZg1ZlGbbsqRdr8JLmU3O
    skip_symbols: false
    artifact: nupkg

  on_finish:
  - ps: Get-ChildItem C:\Screenshots\*.png -Recurse | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }

-
  branches:
    except:
    - nuget

  image: Visual Studio 2017

  before_build:
  - nuget restore JDI.Light/JDI.Light.sln
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/set-screenresolution.ps1'))
  - ps: Set-ScreenResolution 1280 1024

  build_script:
    - msbuild JDI.Light/JDI.Light.sln /p:Configuration=Release /t:Rebuild

  test_script:
  - ps: .\TestsAndCoverage.ps1

  on_finish:
  - ps: Get-ChildItem C:\Screenshots\*.png -Recurse | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }