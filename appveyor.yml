-
  branches:
    only:
    - nuget

  image: Visual Studio 2017

  before_build:
    - nuget restore JDI.Light/JDI.Light.sln

  build_script:
    - msbuild JDI.Light/JDI.Light.sln /p:Configuration=Release /t:Rebuild

  after_build:
    - nuget pack "JDI.Light/JDI.Light.csproj" -Prop Configuration=Release

  artifacts:
    - path: '*.nupkg'
      name: nupkg

  deploy:
    provider: NuGet
    server:
    api_key:
      secure: <ADD_HERE_BEFORE_PUBLISH>
    skip_symbols: false
    artifact: nupkg

  test:
    assemblies:
      - '**\*Tests.dll'

-
  branches:
    except:
    - nuget

  image: Visual Studio 2017

  environment:
    COVERALLS_REPO_TOKEN:
      secure: Lc7yX8JRxQdRZ8yYUPMuxrp22UkAIXLlkQK6H890Sh1GASFiKG4GkjwqbM9zy9O6

  before_build:
  - nuget restore JDI.Light/JDI.Light.sln
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/set-screenresolution.ps1'))
  - ps: Set-ScreenResolution 1280 1024 

  build_script:
    - msbuild JDI.Light/JDI.Light.sln /p:Configuration=Release /t:Rebuild

  test_script:
  - ps: .\TestsAndCoverage.ps1

  on_finish:
  - ps: Get-ChildItem C:\Screenshots\*.png -Recurse | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }